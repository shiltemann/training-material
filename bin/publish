#!/usr/bin/env bash

git config user.name "Travis-CI"
git config user.email "noreply@travis-ci.org"
git remote rm origin
git remote add origin "https://shiltemann:$GH_TOKEN@github.com/shiltemann/training-material"

rm -rf /tmp/site
mv _site /tmp/site

git checkout -- .

git fetch origin
git checkout gh-pages
git clean -fdx
git rm -r .

# restore travis.yml
git reset HEAD .travis.yml
git checkout .travis.yml

cp -R /tmp/site/* .

find * -type f -exec chmod 644 "{}" ";"
find * -type d -exec chmod 755 "{}" ";"

git add -A .
git commit -m "Update on: `date`"
git push origin gh-pages
